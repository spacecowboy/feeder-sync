// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.27.0
// source: devices.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const deleteDevice = `-- name: DeleteDevice :many
DELETE FROM devices
WHERE user_db_id = $1 AND device_id = $2
RETURNING device_id
`

type DeleteDeviceParams struct {
	UserDbID int64
	DeviceID string
}

func (q *Queries) DeleteDevice(ctx context.Context, arg DeleteDeviceParams) ([]string, error) {
	rows, err := q.db.Query(ctx, deleteDevice, arg.UserDbID, arg.DeviceID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []string
	for rows.Next() {
		var device_id string
		if err := rows.Scan(&device_id); err != nil {
			return nil, err
		}
		items = append(items, device_id)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const deleteDeviceWithLegacyId = `-- name: DeleteDeviceWithLegacyId :many
DELETE FROM devices
WHERE user_db_id = $1 AND legacy_device_id = $2
RETURNING legacy_device_id
`

type DeleteDeviceWithLegacyIdParams struct {
	UserDbID       int64
	LegacyDeviceID int64
}

func (q *Queries) DeleteDeviceWithLegacyId(ctx context.Context, arg DeleteDeviceWithLegacyIdParams) ([]int64, error) {
	rows, err := q.db.Query(ctx, deleteDeviceWithLegacyId, arg.UserDbID, arg.LegacyDeviceID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []int64
	for rows.Next() {
		var legacy_device_id int64
		if err := rows.Scan(&legacy_device_id); err != nil {
			return nil, err
		}
		items = append(items, legacy_device_id)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getAllDevices = `-- name: GetAllDevices :many
SELECT db_id, device_id, legacy_device_id, device_name, last_seen, user_db_id FROM devices
`

func (q *Queries) GetAllDevices(ctx context.Context) ([]Device, error) {
	rows, err := q.db.Query(ctx, getAllDevices)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Device
	for rows.Next() {
		var i Device
		if err := rows.Scan(
			&i.DbID,
			&i.DeviceID,
			&i.LegacyDeviceID,
			&i.DeviceName,
			&i.LastSeen,
			&i.UserDbID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getDevices = `-- name: GetDevices :many
SELECT
    db_id, device_id, legacy_device_id, device_name, last_seen, user_db_id
FROM devices
WHERE user_db_id = $1
`

func (q *Queries) GetDevices(ctx context.Context, userDbID int64) ([]Device, error) {
	rows, err := q.db.Query(ctx, getDevices, userDbID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Device
	for rows.Next() {
		var i Device
		if err := rows.Scan(
			&i.DbID,
			&i.DeviceID,
			&i.LegacyDeviceID,
			&i.DeviceName,
			&i.LastSeen,
			&i.UserDbID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getLegacyDevice = `-- name: GetLegacyDevice :one
SELECT
    db_id, device_id, legacy_device_id, device_name, last_seen, user_db_id
FROM devices
WHERE user_db_id = $1 AND legacy_device_id = $2
LIMIT 1
`

type GetLegacyDeviceParams struct {
	UserDbID       int64
	LegacyDeviceID int64
}

func (q *Queries) GetLegacyDevice(ctx context.Context, arg GetLegacyDeviceParams) (Device, error) {
	row := q.db.QueryRow(ctx, getLegacyDevice, arg.UserDbID, arg.LegacyDeviceID)
	var i Device
	err := row.Scan(
		&i.DbID,
		&i.DeviceID,
		&i.LegacyDeviceID,
		&i.DeviceName,
		&i.LastSeen,
		&i.UserDbID,
	)
	return i, err
}

const getLegacyDevicesEtag = `-- name: GetLegacyDevicesEtag :one
SELECT
    sha256(convert_to(string_agg(device_name, '' ORDER BY device_name), 'UTF8'))
FROM devices
WHERE user_db_id = $1
GROUP BY user_db_id
`

func (q *Queries) GetLegacyDevicesEtag(ctx context.Context, userDbID int64) ([]byte, error) {
	row := q.db.QueryRow(ctx, getLegacyDevicesEtag, userDbID)
	var sha256 []byte
	err := row.Scan(&sha256)
	return sha256, err
}

const insertDevice = `-- name: InsertDevice :one
INSERT INTO devices (
    device_id, device_name, last_seen, legacy_device_id, user_db_id
)
VALUES ($1, $2, $3, $4, $5)
RETURNING db_id, device_id, legacy_device_id, device_name, last_seen, user_db_id
`

type InsertDeviceParams struct {
	DeviceID       string
	DeviceName     string
	LastSeen       pgtype.Timestamptz
	LegacyDeviceID int64
	UserDbID       int64
}

func (q *Queries) InsertDevice(ctx context.Context, arg InsertDeviceParams) (Device, error) {
	row := q.db.QueryRow(ctx, insertDevice,
		arg.DeviceID,
		arg.DeviceName,
		arg.LastSeen,
		arg.LegacyDeviceID,
		arg.UserDbID,
	)
	var i Device
	err := row.Scan(
		&i.DbID,
		&i.DeviceID,
		&i.LegacyDeviceID,
		&i.DeviceName,
		&i.LastSeen,
		&i.UserDbID,
	)
	return i, err
}

const updateLastSeenForDevice = `-- name: UpdateLastSeenForDevice :exec
UPDATE devices
SET last_seen = $1
WHERE db_id = $2
`

type UpdateLastSeenForDeviceParams struct {
	LastSeen pgtype.Timestamptz
	DbID     int64
}

func (q *Queries) UpdateLastSeenForDevice(ctx context.Context, arg UpdateLastSeenForDeviceParams) error {
	_, err := q.db.Exec(ctx, updateLastSeenForDevice, arg.LastSeen, arg.DbID)
	return err
}
